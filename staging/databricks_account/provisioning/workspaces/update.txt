PATCH
/api/2.0/accounts/{account_id}/workspaces/{workspace_id}
Updates a workspace configuration for either a running workspace or a failed workspace. The elements that can
be updated varies between these two use cases.
Update a failed workspace
You can update a Databricks workspace configuration for failed workspace deployment for some fields, but not
all fields. For a failed workspace, this request supports updates to the following fields only:
Credential configuration ID
Storage configuration ID
Network configuration ID. Used only to add or change a network configuration for a customer-managed VPC.
For a failed workspace only, you can convert a workspace with Databricks-managed VPC to use a
customer-managed VPC by adding this ID. You cannot downgrade a workspace with a customer-managed VPC to be a Databricks-managed VPC. You can update the network configuration for a failed or running workspace to add
PrivateLink support, though you must also add a private access settings object.
Key configuration ID for managed services (control plane storage, such as notebook source and Databricks
SQL queries). Used only if you use customer-managed keys for managed services.
Key configuration ID for workspace storage (root S3 bucket and, optionally, EBS volumes). Used only if you
use customer-managed keys for workspace storage.
Important
: If the workspace was ever in the running
state, even if briefly before becoming a failed workspace, you cannot add a new key configuration ID for
workspace storage.
Private access settings ID to add PrivateLink support. You can add or update the private access settings ID
to upgrade a workspace to add support for front-end, back-end, or both types of connectivity. You cannot
remove (downgrade) any existing front-end or back-end PrivateLink support on a workspace.
Custom tags. Given you provide an empty custom tags, the update would not be applied.
Network connectivity configuration ID to add serverless stable IP support. You can add or update the network
connectivity configuration ID to ensure the workspace uses the same set of stable IP CIDR blocks to access your
resources. You cannot remove a network connectivity configuration from the workspace once attached, you can only
switch to another one.
After calling the
code: PATCH
operation to update the workspace configuration, make repeated
code: GET
requests with
the workspace ID and check the workspace status. The workspace is successful if the status changes to
code: RUNNING
.
For information about how to create a new workspace with this API
including error handling
, see
Create a new workspace using the Account API
.
Update a running workspace
You can update a Databricks workspace configuration for running workspaces for some fields, but not all
fields. For a running workspace, this request supports updating the following fields only:
Credential configuration ID
Network configuration ID. Used only if you already use a customer-managed VPC. You cannot convert a running
workspace from a Databricks-managed VPC to a customer-managed VPC. You can use a network configuration
update in this API for a failed or running workspace to add support for PrivateLink, although you also need
to add a private access settings object.
Key configuration ID for managed services (control plane storage, such as notebook source and Databricks
SQL queries). Databricks does not directly encrypt the data with the customer-managed key (CMK).
Databricks uses both the CMK and the Databricks managed key (DMK) that is unique to your workspace to
encrypt the Data Encryption Key (DEK). Databricks uses the DEK to encrypt your workspace's managed services
persisted data. If the workspace does not already have a CMK for managed services, adding this ID enables
managed services encryption for new or updated data. Existing managed services data that existed before
adding the key remains not encrypted with the DEK until it is modified. If the workspace already has
customer-managed keys for managed services, this request rotates (changes) the CMK keys and the DEK is
re-encrypted with the DMK and the new CMK.
Key configuration ID for workspace storage (root S3 bucket and, optionally, EBS volumes). You can set this
only if the workspace does not already have a customer-managed key configuration for workspace storage.
Private access settings ID to add PrivateLink support. You can add or update the private access settings ID
to upgrade a workspace to add support for front-end, back-end, or both types of connectivity. You cannot
remove (downgrade) any existing front-end or back-end PrivateLink support on a workspace.
Custom tags. Given you provide an empty custom tags, the update would not be applied.
Network connectivity configuration ID to add serverless stable IP support. You can add or update the network
connectivity configuration ID to ensure the workspace uses the same set of stable IP CIDR blocks to access your
resources. You cannot remove a network connectivity configuration from the workspace once attached, you can only
switch to another one.
Important
: To update a running workspace, your workspace must have no running compute resources that run
in your workspace's VPC in the Classic data plane. For example, stop all all-purpose clusters, job clusters,
pools with running clusters, and Classic SQL warehouses. If you do not terminate all cluster instances in the
workspace before calling this API, the request will fail.
Wait until changes take effect.
After calling the
code: PATCH
operation to update the workspace configuration, make repeated
code: GET
requests with
the workspace ID and check the workspace status and the status of the fields.
For workspaces with a Databricks-managed VPC, the workspace status becomes
code: PROVISIONING
temporarily
(typically under 20 minutes). If the workspace update is successful, the workspace status changes to
code: RUNNING
. Note that you can also check the workspace status in the
Account Console
.
However, you cannot use or create clusters for another 20 minutes after that status change. This results in a
total of up to 40 minutes in which you cannot create clusters. If you create or use clusters before this time
interval elapses, clusters do not launch successfully, fail, or could cause other unexpected behavior.
For workspaces with a customer-managed VPC, the workspace status stays at status
code: RUNNING
and the VPC
change happens immediately. A change to the storage customer-managed key configuration ID might take a few
minutes to update, so continue to check the workspace until you observe that it has been updated. If the
update fails, the workspace might revert silently to its original configuration. After the workspace has
been updated, you cannot use or create clusters for another 20 minutes. If you create or use clusters before
this time interval elapses, clusters do not launch successfully, fail, or could cause other unexpected behavior.
If you update the
storage
customer-managed key configurations, it takes 20 minutes for the changes to fully
take effect. During the 20 minute wait, it is important that you stop all REST API calls to the DBFS API.
If you are modifying
only the managed services key configuration
, you can omit the 20 minute wait.
Important
: Customer-managed keys and customer-managed VPCs are supported by only some deployment types
and subscription types. If you have questions about availability, contact your Databricks representative.
This operation is available only if your account is on the E2 version of the platform or on a select custom
plan that allows multiple workspaces per account.
Path parameters
code: account_id
required
uuid
Databricks account ID of any type. For non-E2 account types, get your account ID from the
Accounts Console
.
code: workspace_id
required
int64
Workspace ID.
Request body
Changes of the workspace properties.
code: aws_region
string
Example
code: "us-west-2"
The AWS region of the workspace's data plane (for example,
code: us-west-2
). This parameter is available only for updating failed workspaces.
code: credentials_id
uuid
ID of the workspace's credential configuration object. This parameter is available for updating both failed and running workspaces.
code: storage_configuration_id
uuid
The ID of the workspace's storage configuration object. This parameter is available only for updating failed workspaces.
code: network_id
uuid
The ID of the workspace's network configuration object. Used only if you already use a customer-managed VPC. For failed workspaces only, you can switch from a Databricks-managed VPC to a customer-managed VPC by updating the workspace to add a network configuration ID.
code: managed_services_customer_managed_key_id
uuid
The ID of the workspace's managed services encryption key configuration object. This parameter is available only for updating failed workspaces.
code: private_access_settings_id
uuid
The ID of the workspace's private access settings configuration object. This parameter is available only for updating failed workspaces.
code: storage_customer_managed_key_id
uuid
The ID of the key configuration object for workspace storage. This parameter is available for updating both failed and running workspaces.
code: custom_tags
object
The custom tags key-value pairing that is attached to this workspace.
The key-value pair is a string of utf-8 characters.
The value can be an empty string, with maximum length of 255 characters.
The key can be of maximum length of 127 characters, and cannot be empty.
code: network_connectivity_config_id
uuid
Example
code: "390afeb4-1111-2222-af33-ca3965c04068"
The ID of the network connectivity configuration to attach to this workspace.
Responses
200
The workspace update request is accepted.
The workspace update request is accepted.
This method might return the following HTTP codes: 400, 401, 403, 404, 409, 500, 509
Error responses are returned in the following format:
{
"error_code"
:
"Error code"
,
"message"
:
"Human-readable error message."
}
Possible error codes:
HTTP code
error_code
Description
400
BAD_REQUEST
Request is invalid.
401
UNAUTHORIZED
The request does not have valid authentication credentials for the operation.
403
PERMISSION_DENIED
Caller does not have permission to execute the specified operation.
404
NOT_FOUND
Operation was performed on a resource that does not exist.
409
RESOURCE_CONFLICT
Request was rejected due a conflict with an existing resource.
500
INTERNAL_SERVER_ERROR
Internal error.
509
SERVICE_UNDER_MAINTENANCE
An external service is unavailable temporarily as it is being updated.